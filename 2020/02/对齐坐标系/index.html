<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  lang="zh-Hans" >

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    
    <title>对齐坐标系 | 凯的博客</title>
    
    
    
    <link rel="stylesheet" href="/blog/css/style.css" />
    <link rel="icon" href="/blog/favicon.ico" type="image/x-icon">

    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="canonical" href="https://kaizhang91.github.io/blog/2020/02/%E5%AF%B9%E9%BD%90%E5%9D%90%E6%A0%87%E7%B3%BB/">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">

    
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>
<section class="section">
  <div class="container">
    <nav id="nav-main" class="nav">
      <div id="nav-name" class="nav-left">
        <a id="nav-anchor" class="nav-item" href="/blog">
          <h1 id="nav-heading" class="title is-4">凯的博客</h1>
        </a>
      </div>
      <div class="nav-right">
        <nav id="nav-items" class="nav-item level is-mobile"><a class="level-item" aria-label="github"
            href='https://github.com/kaizhang91' target='_blank'
            rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
    
  </svg></i>
            </span>
          </a></nav>
      </div>
    </nav>

    <nav class="nav">
      

      
    </nav>

  </div>
  <script src="/js/navicon-shift.js"></script>
</section>
<section class="section">
  <div class="container">
    <h1 class="title">对齐坐标系</h1>
    <div class="subtitle tags is-6 is-pulled-right">
      
      
<a class="subtitle is-6" href="/blog/tags/%E6%95%B0%E5%AD%A6">#数学</a>



      
    </div>
    <h2 class="subtitle is-6">
      2020-02-20 15:35:10 &#43;0800</h2>
    
    <div class="content">
      <h1 id="背景">背景</h1>
<p>给定两组坐标 <span class="math inline">\(\{\vec{p}_i \mid 1 \le i \le m\}\)</span> 和 <span class="math inline">\(\{\vec{q}_i \mid 1 \le i \le m\}\)</span>， 求相似变换 <span class="math inline">\(\transformation{T}\)</span>：</p>
<p><span id="eq:similarityTransformation"><span class="math display">\[
\transformation{T} = \begin{pmatrix}
  s\transformation{R} &amp; \vec{t} \\
  \transpose{\vec{0}} &amp; 1
\end{pmatrix}
\qquad(1)\]</span></span></p>
<p>使得</p>
<p><span id="eq:errorSquare"><span class="math display">\[\sum_{i=1}^m \lvert\hat{\vec{q}}_i- \vec{q}_i\rvert^2\qquad(2)\]</span></span></p>
<p>最小。其中，</p>
<p><span id="eq:pToQ"><span class="math display">\[\hat{\vec{q}}_i = \transformation{R}\vec{p}_i + \vec{t}\qquad(3)\]</span></span></p>
<p><span class="math inline">\(\transformation{R}\)</span> 为正交矩阵，且 <span class="math inline">\(\det(\matrix{R}) = 1\)</span>。</p>
<h1 id="计算方法mathaligncoordinatesystem">计算方法<span class="citation" data-cites="mathAlignCoordinateSystem"><sup>[<a href="#ref-mathAlignCoordinateSystem" role="doc-biblioref">1</a>]</sup></span></h1>
<p>计算两组坐标的平均值：</p>
<p><span id="eq:pBar"><span class="math display">\[\bar{\vec{p}} = \frac{1}{m}\sum_{i=1}^m \vec{p}_i\qquad(4)\]</span></span> <span id="eq:qBar"><span class="math display">\[\bar{\vec{q}} = \frac{1}{m}\sum_{i=1}^m \vec{q}_i\qquad(5)\]</span></span></p>
<p>计算矩阵：</p>
<p><span id="eq:O"><span class="math display">\[
\begin{align}
\matrix{O} &amp;= \sum_{i=1}^m (\vec{q}_i - \bar{\vec{q}})\transpose{(\vec{p}_i - \bar{\vec{p}})} \\
           &amp;= \sum_{i=1}^m \vec{q}_i\transpose{\vec{p}_i} - m\bar{\vec{q}}\transpose{\bar{\vec{p}}}
\end{align}
\qquad(6)\]</span></span></p>
<p>计算 <span class="math inline">\(\matrix{O}\)</span> 的奇异值分解：</p>
<p><span id="eq:OSVD"><span class="math display">\[\matrix{O} = \matrix{U}\matrix{D}\transpose{\matrix{V}}\qquad(7)\]</span></span></p>
<p>计算 <span class="math inline">\(\{c_j \mid 1 \le j \le n\}\)</span>：</p>
<p><span id="eq:cj"><span class="math display">\[
\begin{align}
c_j &amp;= \sum_{i=1}^m [\matrix{V}(\vec{p}_i - \bar{\vec{p}})]_j[\matrix{U}(\vec{q}_i - \bar{\vec{q}})]_j \\
    &amp;= \sum_{i=1}^m (\matrix{V}\vec{p}_i)_j(\matrix{U}\vec{q}_i)_j - m(\matrix{V}\bar{\vec{p}})_j(\matrix{U}\bar{\vec{q}})_j
\end{align}
\qquad(8)\]</span></span></p>
<p>记：</p>
<p><span id="eq:aj"><span class="math display">\[a_j = \sign(c_j)\qquad(9)\]</span></span></p>
<p>则：</p>
<p><span id="eq:R"><span class="math display">\[\transformation{R} = \matrix{V}\diag(a_1, \dots, a_n)\transpose{\matrix{U}}\qquad(10)\]</span></span> <span id="eq:t"><span class="math display">\[\vec{t} = \bar{\vec{q}} - \transformation{R}\bar{\vec{p}}\qquad(11)\]</span></span></p>
<blockquote>
<p>如果 <span class="math inline">\(\det(\matrix{R}) &lt; 0\)</span>，需要改变绝对值最小的 <span class="math inline">\(c_j\)</span> 对应的 <span class="math inline">\(a_j\)</span> 的符号。</p>
</blockquote>
<p><span class="math inline">\(s\)</span> 可由式. 12 或式. 13 得到，</p>
<p><span id="eq:sOriginal"><span class="math display">\[
s\sum_{i=1}^m\lvert\vec{p}_i - \bar{\vec{p}}\rvert^2 =
  \sum_{i=1}^m\langle\transformation{R}(\vec{p}_i - \bar{\vec{p}}), \vec{q}_i - \bar{\vec{q}}\rangle
\qquad(12)\]</span></span></p>
<p><span id="eq:sSimple"><span class="math display">\[
s\left(\sum_{i=1}^m\lvert\vec{p}_i\rvert^2 - m\lvert\bar{\vec{p}}\rvert^2\right) =
  \sum_{i=1}^m\langle\transformation{R}\vec{p}_i, \vec{q}_i\rangle - m\langle\transformation{R}\bar{\vec{p}}, \bar{\vec{q}}\rangle
\qquad(13)\]</span></span></p>
<h1 class="unnumbered" id="参考文献" class="unnumbered">参考文献</h1>
<div id="refs" class="references" role="doc-bibliography">
<div id="ref-mathAlignCoordinateSystem">
<p>[1] ROBJOHN. Given 3 points of a rigid body in space, how do I find the corresponding orientation (aka rotation or attitude)?[EB/OL](2012–10–27). <a href="https://math.stackexchange.com/a/222170">https://math.stackexchange.com/a/222170</a>.</p>
</div>
</div>

      
    </div>
    
  </div>
</section>



<section class="section">
  <div class="container has-text-centered">
    <p></p>
    
  </div>
</section>




<script>
  
  MathJax = {
    tex: {
      macros: {
        transformation: ["{\\mathcal{#1}}", 1],
        bm: ["{\\boldsymbol{#1}}", 1],
        vec: ["{\\bm{#1}}", 1],
        matrix: ["{\\bm{#1}}", 1],
        transpose: ["{#1}^{\\mathsf{T}}", 1],
        sign: ["\\textrm{sign}"],
        diag: ["\\textrm{diag}"],
      }
    }
  };
</script>
</body>

</html>